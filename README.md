Конечно! Вот инструкция в формате Markdown для настройки **VLESS клиента на виртуальной машине** и **маршрутизации трафика через USG Pro-4**.

```markdown
# Настройка VLESS клиента на виртуальной машине и маршрутизация через USG Pro-4

Этот документ описывает шаги для настройки **VLESS клиента** на виртуальной машине с CentOS, а также настройки маршрутизации трафика через маршрутизатор **USG Pro-4**.

## 1. Развертывание виртуальной машины на сервере

### 1.1 Установка гипервизора
Для начала, если у тебя еще нет гипервизора, установи его. Мы будем использовать **VMware** или **Proxmox** для создания виртуальной машины. 

Пример для **VMware**:
1. Установи **VMware Workstation** или **VMware ESXi**.
2. Создай новую виртуальную машину с Linux (CentOS) как ОС.

### 1.2 Установка CentOS на виртуальную машину
1. Загрузи образ **CentOS** с [официального сайта](https://www.centos.org/download/).
2. Установи CentOS на виртуальную машину через установочный процесс (следуй подсказкам инсталлятора).

После установки системы, зайди в систему как root.

## 2. Установка и настройка V2Ray (VLESS)

### 2.1 Установка V2Ray на CentOS

1. Обнови систему:
    ```bash
    sudo yum update -y
    ```

2. Установи V2Ray с официального скрипта:
    ```bash
    bash <(curl -L https://raw.githubusercontent.com/v2fly/fhs-install-v2ray/master/install-release.sh)

    ```

3. Проверь, что V2Ray установлен:
    ```bash
    systemctl status v2ray
    ```

### 2.2 Настройка конфигурации V2Ray для VLESS

1. Открой конфигурационный файл V2Ray:
    ```bash
    sudo nano /etc/v2ray/config.json
    ```

2. Пример конфигурации клиента VLESS:
    ```json
    {
      "inbounds": [
        {
          "port": 1080,
          "listen": "127.0.0.1",
          "protocol": "socks",
          "settings": {
            "auth": "noauth",
            "udp": true
          }
        }
      ],
      "outbounds": [
        {
          "protocol": "vless",
          "settings": {
            "vnext": [
              {
                "address": "<IP_сервера>",
                "port": 443,
                "users": [
                  {
                    "id": "<UUID>",
                    "alterId": 0
                  }
                ]
              }
            ]
          },
          "streamSettings": {
            "network": "tls",
            "security": "tls",
            "tlsSettings": {
              "serverName": "<имя_сервера>",
              "allowInsecure": false
            }
          }
        }
      ],
      "routing": {
        "rules": [
          {
            "type": "field",
            "ip": ["geoip:cn"],
            "outboundTag": "direct"
          },
          {
            "type": "field",
            "ip": ["geoip:private"],
            "outboundTag": "direct"
          }
        ]
      },
      "dns": {
        "servers": [
          "8.8.8.8",
          "8.8.4.4"
        ]
      }
    }
    ```

3. Внеси изменения:
    - `<IP_сервера>`: IP адрес твоего VLESS сервера.
    - `<UUID>`: UUID для клиента (можно сгенерировать командой `uuidgen`).
    - `<имя_сервера>`: Доменное имя сервера для TLS.

### 2.3 Запуск и проверка V2Ray

1. Перезапусти V2Ray:
    ```bash
    sudo systemctl restart v2ray
    sudo systemctl enable v2ray
    ```

2. Проверка статуса:
    ```bash
    sudo systemctl status v2ray
    ```

### 2.4 Проверка работы клиента

Для проверки работы V2Ray можно использовать команду:
```bash
curl --proxy socks5://127.0.0.1:1080 https://www.google.com
```

Если страница загружается через прокси, значит, V2Ray работает корректно.

## 3. Настройка маршрутизации через USG Pro-4

### 3.1 Подготовка маршрутизатора USG Pro-4

1. Включи USG Pro-4 и подключи его к локальной сети.
2. Открой веб-интерфейс **UniFi Controller**.

### 3.2 Создание маршрута для направляющего трафика через VLESS

1. Перейди в раздел **Routing & Firewall** на UniFi Controller.
2. Включи создание статического маршрута для определённых IP-адресов или диапазонов, которые ты хочешь направить через VLESS.

Пример маршрута:
- **Source IP:** `192.168.1.0/24`
- **Destination IP:** `0.0.0.0/0` (или конкретный адрес назначения)
- **Next Hop:** IP адрес виртуальной машины, где настроен VLESS клиент.

### 3.3 Настройка правил NAT

Для корректной работы трафика с виртуальной машины (где настроен VLESS клиент), необходимо настроить правила NAT, чтобы трафик с локальных машин шел через прокси.

1. Перейди в раздел **Firewall** в UniFi Controller.
2. Создай правило, которое будет направлять трафик с локальных IP-адресов через IP виртуальной машины.

Пример настройки:
- **Source Network:** `192.168.1.0/24`
- **Destination IP:** `0.0.0.0/0`
- **NAT Type:** Masquerade (или Source NAT)

### 3.4 Проверка маршрутизации

После настройки маршрутов и NAT, проверь, что трафик проходит через VLESS:

1. На одном из клиентов в сети попытайся подключиться к удаленному серверу.
2. Проверь, что IP-адрес клиента виден как внешний (проверь через сервисы типа `https://whatismyipaddress.com`).

### 3.5 Настройка мониторинга

Используя UniFi Controller, можешь настроить мониторинг для отслеживания активности трафика и проверку статистики.

## 4. Заключение

Теперь у тебя есть настроенная виртуальная машина с клиентом VLESS, маршрутизация трафика через USG Pro-4, а также настройка проксирования для обхода блокировок и обфускации трафика.

Эта инструкция может быть использована для интеграции VLESS клиента в локальную сеть с использованием USG Pro-4 для маршрутизации трафика.

## 5. Репозиторий GitHub

Для хранения этого процесса в репозитории GitHub, создай новый репозиторий и добавь этот файл с расширением `.md` в корень репозитория.

```bash
git init
git add README.md
git commit -m "Initial commit with setup instructions"
git branch -M main
git remote add origin <your-repo-url>
git push -u origin main
```

Теперь инструкция доступна для использования и совместного доступа!
```

### Как использовать:

1. Скопируй этот текст в файл `README.md`.
2. Помести файл в репозиторий на GitHub.
3. Используй шаги для настройки и маршрутизации для своей системы.

Теперь у тебя есть полный процесс развертывания с настройкой на виртуальной машине и маршрутизацией через **USG Pro-4**!
